#include <string.h>
#include "udis.h"

static char *ADnames[] =
{
  "A+Q",	  "A+B",	  "0+Q",    "0+B",    "0+A",	"D+A",		"D+Q",		"0+D",
  "Q-A-.25",	  "B-A-.25",	  "Q-.25",  "B-.25",  "A-.25",	"A-D-.25",	"Q-D-.25",	"-D-.25",
  "A-Q-.25",	  "A-B-.25",	  "-Q.25",  "-B.25",  "-A.25",	"D-A-.25",	"D-Q-.25",	"D-.25",
  "A.OR.Q",	  "A.OR.B",	  "Q",	    "B",      "A",	"D.OR.A",	"D.OR.Q",	"D",
  "A.AND.Q",	  "A.AND.B",	  "ZERO",   "ZERO",   "ZERO",	"D.AND.A",	"D.AND.Q",	"ZERO",
  ".NOT.A.AND.Q", ".NOT.A.AND.B", "Q",	    "B",      "A",	".NOT.D.AND.A",	".NOT.D.AND.Q",	"ZERO",
  "A.XOR.Q",	  "A.XOR.B",	  "Q",	    "B",      "A",	"D.XOR.A",	"D.XOR.Q",	"D",
  "A.EQV.Q",	  "A.EQV.B",	  ".NOT.Q", ".NOT.B", ".NOT.A",	"D.EQV.A",	"D.EQV.Q",	".NOT.D",
};

static char *SRCnames[] =
{
  "AQ", "AB", "0Q", "0B", "0A", "DA", "DQ", "D0"
};

static char *DESTnames[] =
{
  "A", "AD", "Q_AD", "PASS", "Q_Q*2", "AD*2", "Q_Q*.5", "AD*.5",
};

static char *ABnames[] =
{
  "MAG", "PC", "HR", "AR", "ARX", "BR", "BRX", "ONE",
  "EBR", "UBR", "MASK", "FLG", "PI", "XWD1", "T0", "T1"
};

static char *RAMADRnames[] =
{
  "AC#", "AC*#", "XR#", "3", "VMA", "5", "RAM", "#"
};

static char *DBUSnames[] =
{
  "PC FLAGS", /* "PI NEW", "VMA", */ "DP", "RAM", "DBM"
};

static char *DBMnames[] =
{
  "SCAD DIAG", /* "PF DISP", "APR FLAGS", */ "BYTES", "EXP",
  "DP", "DP SWAP", "VMA", "MEM", "#"
};

static char *SPECnames[] =
{
  "0", "1", "2", "3", "4", "5", "6", "7"
  "#", "CLRCLK", "CLR IO LATCH", "CLR IO BUSY", "LDPAGE", "NICOND", "LDPXCT",
    "WAIT",
  "PREV", "LOADCR", "22", "APR FLAGS", "CLRCSH", "APR EN", "26", "MEMCLR",
  "30", "31", "32", "33", "SWEEP", "35", "PXCT OFF", "37",
  "INCRY18", "LOADIR", "42", "LDPI", "ASHOV", "EXPTST", "FLAGS", "LDACBLK",
  "50", "51", "52", "53", "54", "55", "56", "57",
  "60", "LDINST", "62", "63", "64", "65", "66", "67",
  "70", "71", "72", "73", "74", "75", "76", "77",
};

static char *DISPnames[] =
{
  "CONSOLE", "1", "2", "3", "4", "5", "6", "7"
  "10", "11", "DROM", "AREAD", "14", "15", "16", "17",
  "20", "21", "22", "23", "24", "25", "26", "27"
  "30", "DP LEFT", "32", "33", "NORM", "DP", "ADISP", "BDISP",
  "40", "RETURN", "42", "43", "44", "45", "46", "47",
  "50", "51", "52", "53", "54", "55", "56", "57",
  "60", "61", "MUL", "PAGE FAIL", "NICOND", "BYTE", "EAMODE", "SCAD0",
  "70", "71", "72", "73", "74", "75", "76", "77",
};

static char *SKIPnames[] =
{
  "0", "1", "2", "3", "IOLGL", "5", "6", "7",
  "10", "11", "LLE", "13", "14", "15", "16", "17",
  "20", "21", "22", "23", "24", "25", "26", "27"
  "30", "CRY0", "ADLEQ0", "ADREQ0", "KERNEL", "FPD", "AC0", "INT",
  "40", "41", "LE", "43", "44", "45", "46", "47",
  "50", "CRY2", "DP0", "DP18", "IOT", "JFCL", "CRY1", "TXXX",
  "60", "TRAP CYCLE", "ADEQ0", "SC", "EXECUTE", "-IO BUSY", "-CONTINE","-1 MS",
  "70", "71", "72", "73", "74", "75", "76", "77",
};

static char *Tnames[] =
{
  "2T", "3T", "4T", "5T"
};

static char *PCXTnames[] =
{
  "CURRENT", "E1", "2", "D1", "BIS-SRC-EA", "E2", "BIS-DST-EA", "D2"
};

static char *WORKnames[] =
{
      "0",     "1",     "2",     "3",     "4",     "5",     "6",     "7",
     "10",    "11",    "12",    "13",    "14",    "15",    "16",    "17",
     "20",    "21",    "22",    "23",    "24",    "25",    "26",    "27",
     "30",    "31",    "32",    "33",    "34",    "35",    "36",    "37",
     "40",    "41",    "42",    "43",    "44",    "45",    "46",    "47",
     "50",    "51",    "52",    "53",    "54",    "55",    "56",    "57",
     "60",    "61",    "62",    "63",    "64",    "65",    "66",    "67",
     "70",    "71",    "72",    "73",    "74",    "75",    "76",    "77",
    "100",   "101",   "102",   "103",   "104",   "105",   "106",   "107",
    "110",   "111",   "112",   "113",   "114",   "115",   "116",   "117",
    "120",   "121",   "122",   "123",   "124",   "125",   "126",   "127",
    "130",   "131",   "132",   "133",   "134",   "135",   "136",   "137",
    "140",   "141",   "142",   "143",   "144",   "145",   "146",   "147",
    "150",   "151",   "152",   "153",   "154",   "155",   "156",   "157",
  "BADW0", "BADW1",   "162",   "163",   "164",   "165",   "166",   "167",
    "170",   "171",   "172",   "173",   "174",   "175",   "176",   "177",
    "MUL",   "DIV",   "202",   "203",   "204",   "205",   "206",   "207",
 "SV.VMA", "SV.AR","SV.ARX", "SV.BR","SV.BRX",
#ifndef ITS
    "SBR",   "CBR",  "CSTM",   "PUR",
#else
   "DBR1",  "DBR2",  "DBR3",   "DBR4",
#endif
            "ADJP",  "ADJS","ADJPTR", "ADJQ1", "ADJR2","ADJBPW","HSBADR",
    "APR", "U.JPC", "E.JPC",  "PCST",   "234",   "235",   "236",   "237",
     "E0",    "E1",  "SLEN",   "MSK",  "FILL",   "CMS",  "FSIG",   "BDH",
    "BDL",   "251",   "252",   "253",   "254",   "255",   "256",   "257",
    "260",   "261",   "262",   "263",   "264",   "265",   "266",   "267",
    "270",   "271",   "272",   "273",   "274",   "275",   "276",   "277",
  "TIME0", "TIME1","PERIOD" ,  "TTG",  "QUAN",   "305",   "306",   "307",
    "310",   "311",   "312",   "313",   "AC0",   "AC1",   "AC2",   "AC3",
"DDIV SGN","DVSOR H","DVSOR L","323",   "324",   "325",   "326",   "327",
    "330",   "331",   "332",   "333",   "334",   "335",   "336",   "337",
    "340",   "341",   "342",   "343", "DECLO",   "345",   "346",   "347",
    "350",   "351",   "352",   "353",   "354",   "355",   "356",   "357",
    "360",   "361",   "362",   "363",   "364",   "365",   "366",   "367",
    "370",   "371",   "372",  "DECHI",  "374",   "375",   "376",   "377",
    "400",   "401",   "402",   "403",   "404",   "405",   "406",   "407",
    "410",   "411",   "412",   "413",   "414",   "415",   "416",   "417",
    "420",   "421", "YSAVE", "PTA.E", "PTA.U","TRAPPC", "SV.AR1",  "427",
    "430",   "431",   "432",   "433",   "434",   "435",   "436",   "437",
    "440",   "441",   "442",   "443",   "444",   "445",   "446",   "447",
    "450",   "451",   "452",   "453",   "454",   "455",   "456",   "457",
    "460",   "461",   "462",   "463",   "464",   "465",   "466",   "467",
    "470",   "471",   "472",   "473",   "474",   "475",   "476",   "477",
    "500",   "501",   "502",   "503",   "504",   "505",   "506",   "507",
    "510",   "511",   "512",   "513",   "514",   "515",   "516",   "517",
    "520",   "521",   "522",   "523",   "524",   "525",   "526",   "527",
    "530",   "531",   "532",   "533",   "534",   "535",   "536",   "537",
    "540",   "541",   "542",   "543",   "544",   "545",   "546",   "547",
    "550",   "551",   "552",   "553",   "554",   "555",   "556",   "557",
    "560",   "561",   "562",   "563",   "564",   "565",   "566",   "567",
    "570",   "571",   "572",   "573",   "574",   "575",   "576",   "577",
    "600",   "601",   "602",   "603",   "604",   "605",   "606",   "607",
    "610",   "611",   "612",   "613",   "614",   "615",   "616",   "617",
    "620",   "621",   "622",   "623",   "624",   "625",   "626",   "627",
    "630",   "631",   "632",   "633",   "634",   "635",   "636",   "637",
    "640",   "641",   "642",   "643",   "644",   "645",   "646",   "647",
    "650",   "651",   "652",   "653",   "654",   "655",   "656",   "657",
    "660",   "661",   "662",   "663",   "664",   "665",   "666",   "667",
    "670",   "671",   "672",   "673",   "674",   "675",   "676",   "677",
    "700",   "701",   "702",   "703",   "704",   "705",   "706",   "707",
    "710",   "711",   "712",   "713",   "714",   "715",   "716",   "717",
    "720",   "721",   "722",   "723",   "724",   "725",   "726",   "727",
    "730",   "731",   "732",   "733",   "734",   "735",   "736",   "737",
    "740",   "741",   "742",   "743",   "744",   "745",   "746",   "747",
    "750",   "751",   "752",   "753",   "754",   "755",   "756",   "757",
    "760",   "761",   "762",   "763",   "764",   "765",   "766",   "767",
    "770",   "771",   "772",   "773",   "774",   "775",   "776",   "777",
   "1000",  "1001",  "1002",  "1003",  "1004",  "1005",  "1006",  "1007",
   "1010",  "1011",  "1012",  "1013",  "1014",  "1015",  "1016",  "1017",
   "1020",  "1021",  "1022",  "1023",  "1024",  "1025",  "1026",  "1027",
   "1030",  "1031",  "1032",  "1033",  "1034",  "1035",  "1036",  "1037",
   "1040",  "1041",  "1042",  "1043",  "1044",  "1045",  "1046",  "1047",
   "1050",  "1051",  "1052",  "1053",  "1054",  "1055",  "1056",  "1057",
   "1060",  "1061",  "1062",  "1063",  "1064",  "1065",  "1066",  "1067",
   "1070",  "1071",  "1072",  "1073",  "1074",  "1075",  "1076",  "1077",
   "1100",  "1101",  "1102",  "1103",  "1104",  "1105",  "1106",  "1107",
   "1110",  "1111",  "1112",  "1113",  "1114",  "1115",  "1116",  "1117",
   "1120",  "1121",  "1122",  "1123",  "1124",  "1125",  "1126",  "1127",
   "1130",  "1131",  "1132",  "1133",  "1134",  "1135",  "1136",  "1137",
   "1140",  "1141",  "1142",  "1143",  "1144",  "1145",  "1146",  "1147",
   "1150",  "1151",  "1152",  "1153",  "1154",  "1155",  "1156",  "1157",
   "1160",  "1161",  "1162",  "1163",  "1164",  "1165",  "1166",  "1167",
   "1170",  "1171",  "1172",  "1173",  "1174",  "1175",  "1176",  "1177",
   "1500",  "1501",  "1502",  "1503",  "1504",  "1505",  "1506",  "1507",
   "1510",  "1511",  "1512",  "1513",  "1514",  "1515",  "1516",  "1517",
   "1520",  "1521",  "1522",  "1523",  "1524",  "1525",  "1526",  "1527",
   "1530",  "1531",  "1532",  "1533",  "1534",  "1535",  "1536",  "1537",
   "1540",  "1541",  "1542",  "1543",  "1544",  "1545",  "1546",  "1547",
   "1550",  "1551",  "1552",  "1553",  "1554",  "1555",  "1556",  "1557",
   "1560",  "1561",  "1562",  "1563",  "1564",  "1565",  "1566",  "1567",
   "1570",  "1571",  "1572",  "1573",  "1574",  "1575",  "1576",  "1577",
   "1600",  "1601",  "1602",  "1603",  "1604",  "1605",  "1606",  "1607",
   "1610",  "1611",  "1612",  "1613",  "1614",  "1615",  "1616",  "1617",
   "1620",  "1621",  "1622",  "1623",  "1624",  "1625",  "1626",  "1627",
   "1630",  "1631",  "1632",  "1633",  "1634",  "1635",  "1636",  "1637",
   "1640",  "1641",  "1642",  "1643",  "1644",  "1645",  "1646",  "1647",
   "1650",  "1651",  "1652",  "1653",  "1654",  "1655",  "1656",  "1657",
   "1660",  "1661",  "1662",  "1663",  "1664",  "1665",  "1666",  "1667",
   "1670",  "1671",  "1672",  "1673",  "1674",  "1675",  "1676",  "1677",
   "1700",  "1701",  "1702",  "1703",  "1704",  "1705",  "1706",  "1707",
   "1710",  "1711",  "1712",  "1713",  "1714",  "1715",  "1716",  "1717",
   "1720",  "1721",  "1722",  "1723",  "1724",  "1725",  "1726",  "1727",
   "1730",  "1731",  "1732",  "1733",  "1734",  "1735",  "1736",  "1737",
   "1740",  "1741",  "1742",  "1743",  "1744",  "1745",  "1746",  "1747",
   "1750",  "1751",  "1752",  "1753",  "1754",  "1755",  "1756",  "1757",
   "1760",  "1761",  "1762",  "1763",  "1764",  "1765",  "1766",  "1767",
   "1770",  "1771",  "1772",  "1773",  "1774",  "1775",  "1776",  "1777",
};

static int SPECbits[] = { 110, 111, 116, 46, 47, 48, -1 };
static int DISPbits[] = { 117, 118, 119, 43, 44, 45, -1 };
static int SKIPbits[] = { 107, 108, 109, 49, 50, 51, -1 };
static int NUMBERbits[] = { 70, 71, 76, 77, 78, 79, 52, 53, 54,
			    55, 56, 57, 58, 59, 60, 61, 62, 63, -1 };

static int
always (int i, struct ks10_uinsn *insn)
{
  return 1;
}

static int
never (int i, struct ks10_uinsn *insn)
{
  return 0;
}

static int
ifMEM (int i, struct ks10_uinsn *insn)
{
  return get_field ("MEM", insn) == 1;
}

static int
ifWORK (int i, struct ks10_uinsn *insn)
{
  return 0;
}

static int
otherw (int i, struct ks10_uinsn *insn)
{
  return !(ifMEM (i, insn) || ifWORK (i, insn));
}

#define RANGE(first, last) { { first, last } }
#define SINGLE(bit) RANGE(bit, bit)
#define LIST(x) { list: { -1, x } }

struct field fields[] =
{
  /* name,		print?,	bits,			deflt,	value names */
  { "J",		always,	RANGE (92, 103),	-1,	0 },
  { "AD",		always,	RANGE (0, 5),		044,	ADnames },
  { "LSRC",		never,	RANGE (3, 5),		-1,	SRCnames },
  { "RSRC",		always,	RANGE (6, 8),		-2,	SRCnames },
  { "DEST",		always,	RANGE (27, 29),		3,	DESTnames },
  { "A",		always,	RANGE (14, 17),		-1,	ABnames },
  { "B",		always,	RANGE (20, 23),		0,	ABnames },
  { "RAMADR",		always,	RANGE (24, 26),		4,	RAMADRnames },
  { "DBUS",		always,	RANGE (12, 13),		1,	DBUSnames },
  { "DBM",		always,	RANGE (9, 11),		7,	DBMnames },
  { "CLKL",		always,	SINGLE (18),		1,	0 },
  { "GENL",		always,	SINGLE (66),		0,	0 },
  { "CHKL",		always,	SINGLE (36),		0,	0 },
  { "CLKR",		always,	SINGLE (19),		1,	0 },
  { "GENR",		always,	SINGLE (67),		0,	0 },
  { "CHKR",		always,	SINGLE (37),		0,	0 },
  { "SPEC",		always,	LIST (SPECbits),	0,	SPECnames },
  { "DISP",		always,	LIST (DISPbits),	070,	DISPnames },
  { "SKIP",		always,	LIST (SKIPbits),	070,	SKIPnames },
  { "T",		always,	RANGE (104, 105),	-1,	Tnames },
  { "CRY38",		always,	SINGLE (41),		0,	0 },
  { "LOADSC",		always,	SINGLE (30),		0,	0 },
  { "LOADFE",		always,	SINGLE (31),		0,	0 },
  { "FMWRITE",		always,	SINGLE (64),		0,	0 },
  { "MEM",		always,	SINGLE (42),		0,	0 },
  { "DIVIDE",		always,	SINGLE (68),		0,	0 },
  { "MULTI PREC",	always,	SINGLE (69),		0,	0 },
  { "MULTI SHIFT",	always,	SINGLE (65),		0,	0 },
  { "CALL",		always,	SINGLE (106),	0,	0 },

  { "FORCE USER",	ifMEM,	SINGLE (70),		0,	0 },
  { "FORCE EXEC",	ifMEM,	SINGLE (71),		0,	0 },
  { "FETCH",		ifMEM,	SINGLE (76),		0,	0 },
  { "READ CYCLE",	ifMEM,	SINGLE (77),		0,	0 },
  { "WRITE TEST",	ifMEM,	SINGLE (78),		0,	0 },
  { "WRITE CYCLE",	ifMEM,	SINGLE (79),		0,	0 },
  { "DONT CACHE",	ifMEM,	SINGLE (53),		0,	0 },
  { "PHYSICAL",		ifMEM,	SINGLE (54),		0,	0 },
  { "PCXT",		ifMEM,	RANGE (55, 57),		-1,	PCXTnames },
  { "AREAD",		ifMEM,	SINGLE (58),		0,	0 },
  { "DP FUNC",		ifMEM,	SINGLE (59),		0,	0 },
  { "LDVMA",		ifMEM,	SINGLE (60),		0,	0 },
  { "EXT ADR",		ifMEM,	SINGLE (61),		0,	0 },
  { "DP WAIT",		ifMEM,	SINGLE (62),		0,	0 },
  { "BWRITE",		ifMEM,	SINGLE (63),		0,	0 },

  { "WORK",		ifWORK,	RANGE (54, 63),		0,	WORKnames },

  { "#",		otherw,	LIST (NUMBERbits),	0,	0 },
};

int field_num = sizeof fields / sizeof fields[0];

int
get_field (char *name, struct ks10_uinsn *insn)
{
  int i;

  for (i = 0; i < field_num; i++)
    {
      if (strcmp (name, fields[i].name) == 0)
	return insn->field[i];
    }

  return -1;
}
